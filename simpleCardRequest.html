<!DOCTYPE html>
<html lang="es">  
<head>    
    <title>Payment APM</title>    
    <link href="https://paymentez.github.io/api-doc/images/favicon-d165b374.svg" rel="icon" type="image/svg">
    <meta charset="UTF-8">
    <meta name="title" content="Test Nuvei">
    <meta name="description" content="DescripciÃ³n de la WEB"> 
    <link rel="stylesheet" type="text/css" href="style.css">    
   
</head>  
<body> 
  
    <header>
           
    </header>

</head>
<body>
<div class="navbar">
     <ul>
        <li><a href="welcome.html">Introduction</a></li>
        <li><a href="sessionToken.html">Session Token</a></li>
        <li><a href="openOrder.html">Open Order</a></li>
        <li><a href="initPayment.html">Init Payment</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Payment</a>
          <ul class="dropdown-menu">
            <li><a href="simpleCardRequest.html">Simple Card Request</a></li>
            <li><a href="fullCardRequest.html">Full Card Request</a></li>
            <li><a href="paymentAPM.html">Payment APM</a></li>
            <li><a href="#">Otro</a></li>
          </ul>
        </li>
        <li><a href="settleTransaction.html">Settle Transaction</a></li>
        <li><a href="#">Refund Transaction</a></li>
        <li><a href="#">Void Transaction</a></li>
        <li><a href="#">Payout</a></li>
        <li><a href="#">Get Payment Status</a></li>
        <li><a href="#">Get Payout Status</a></li>
        <li><a href="#">Account Capture</a></li>  

    </ul>
</div>
    
  </head>
  <body>
    <div class='container'>
    <img class="image" src="https://cdn.paymentez.com/img/nv/nuvei_logo.png"> 
    <form>
      <label for="sessionToken">Session Token:</label>
      <input type="text" id="sessionToken" name="sessionToken" required>

      <label for="amount">Amount:</label>
      <input type="number" id="amount" name="amount" required>

      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required>

      <input type="button" value="Enviar" onclick="obtenerDatos()">
    </form>
    </div>
          <div id='result'></div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>  
 

<script type="text/javascript">



function obtenerDatos(){
    document.getElementById('result').innerHTML = '';
    var sessionToken = document.getElementById('sessionToken').value;
    var amount = document.getElementById('amount').value;
    var email = document.getElementById('email').value;
    var merchant_site_id = '237908';
    var merchant_id = '4737702845234463918';

    if (!sessionToken || !amount || !email) {
      alert("Por favor ingrese todos los campos");
      return;
    }
  
const fecha = new Date();
const timestamp = `${fecha.getFullYear()}${padZero(fecha.getMonth() + 1)}${padZero(fecha.getDate())}${padZero(fecha.getHours())}${padZero(fecha.getMinutes())}${padZero(fecha.getSeconds())}`;

  function padZero(valor) {
    return valor.toString().padStart(2, '0');
  }
  const merchant_secret_key = 'ltNoJFPesAqVsVazh7LwoNINMGbHwDJ2GTLRAaYegaCb29r8pjQvBCi1fJySEtbh';
  const client_request_id ='1C6CT7V1L';
  const clientUniqueId ='123456'
  const currency = 'PEN'


  const cadena =CryptoJS.SHA256(merchant_id + merchant_site_id + client_request_id + amount.toString() +currency + timestamp + merchant_secret_key);
  const checksum = cadena.toString();
 
  
    var myHeaders = new Headers();
    myHeaders.append("Content-Type", "application/json");
    
  
    var raw = JSON.stringify({
    "sessionToken":sessionToken,
    "merchantId":merchant_id,
    "merchantSiteId":merchant_site_id,
    "clientRequestId":client_request_id,
    "amount":amount,
    "currency":currency,
    "userTokenId":"230811147",
    "clientUniqueId":clientUniqueId,
    "paymentOption":{
        "card":{
            "cardNumber":"4000027891380961",
            "cardHolderName":"John Smith",
            "expirationMonth":"12",
            "expirationYear":"2030",
            "CVV":"217"
        }
    },
    "deviceDetails":{
        "ipAddress":"192.168.2.38"
    },
    "billingAddress":{
        "firstName": "John",
        "lastName": "Smith",
        "email":email,
        "country":"US"
    },
    "timeStamp":timestamp,
    "checksum":checksum
}
);
  
    var requestOptions = {
      method: 'POST',
      headers: myHeaders,
      body: raw,
      redirect: 'follow'
    };
  
    fetch("https://ppp-test.nuvei.com/ppp/api/v1/payment.do", requestOptions)
      .then(response => response.json())
      .then(result => {

        //const redirectUrl = result.paymentOption.redirectUrl
        //window.location.href = redirectUrl;
        //document.getElementById("redirectUrl").textContent = redirectUrl;
        document.getElementById('result').innerHTML = JSON.stringify(result, null, 2);
      })
      .catch(error => console.log('error', error));
}



</script>
</script>
<script src="index.js" type="text/javascript"></script>
</body>  
</html>

